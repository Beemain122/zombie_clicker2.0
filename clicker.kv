#:import from_hex kivy.utils.get_color_from_hex
#:import to_rgba kivy.utils.rgba
#:import colormap kivy.utils.colormap

#:set main_color '#00a100'
#:set main_color_dark "#09f47c"


<Widget>:
    font_name: 'assets/Lemon-Regular.ttf'


<ButtonMenu@Button>: 
    font_size: "56sp"
    bold: True 
    background_color: 0, 0, 0, 0
    size_hint: None, None
    pos_hint: {"center_x": 0.5}
    width: self.texture_size[0] + dp(40)   # ширина = текст + відступи

    canvas.before:
        Color:
            rgba: colormap['darkgreen']
        RoundedRectangle:
			size: self.size
			pos: self.pos
			radius: [self.font_size]
		Color:
			rgba: from_hex(main_color) if self.state == 'normal' else from_hex(main_color_dark)
		RoundedRectangle:
			size: self.size[0] - dp(6), self.size[1] - dp(6)
			pos: self.pos[0] + dp(3), self.pos[1] + dp(3)
			radius: [self.font_size]
 

<ButtonIcon@ButtonMenu>: 
    font_name: 'assets/typicons.ttf'

<Menu>:
    BoxLayout:
        orientation: "vertical" 
        padding: "30dp"
        spacing: "20dp"   

        canvas:
            Rectangle:
                source: 'assets/images/back_menu.png'
                size: dp(750), self.size[1]
                pos: self.center_x - dp(750) / 2, self.y

        Widget:
            size_hint_y: 0.05

        Image:
            source: "assets/images/title.png"
            allow_stretch: True
            size_hint_y: 0.5
   
        ButtonMenu:
            text: " PLAY "
            size_hint_y: 0.15

            on_press: 
                root.manager.current = "game"
                root.manager.transition.direction = "left"

        BoxLayout:
            size_hint_y: 0.15

            # Button "Settings" 
            ButtonIcon: 
                text: "\uE04F"
                on_press:
                    root.go_settings() 

            Widget:

            # Button "Exit" 
            ButtonIcon: 
                text: "\uE121" 
                on_press:
                    app.stop() 


<Settings>:
    BoxLayout:
        orientation: "vertical"
        padding: "30dp"
        spacing: "20dp"

        Label:
            text: "Settings"
            font_size: "40sp"

        # Зеленая кнопка с иконкой для музыки
        ToggleButton:
            id: music_button
            size_hint: None, None
            size: dp(100), dp(100)
            background_color: 0, 1, 0, 1  # зеленый квадрат
            border: (0, 0, 0, 0)
            text: "\uE116"
            font_name: 'assets/typicons.ttf'
            font_size: '40sp'
            color: 1, 1, 1, 1  # цвет иконки белый
            on_state: root.toggle_music(self.state)

        # Ползунок для управления громкостью
        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: dp(60)
            spacing: dp(20)

            Label:
                text: "Volume"
                font_size: "24sp"
                size_hint_x: 0.2

            Slider:
                id: volume_slider
                min: 0
                max: 1
                value: root.volume_level if hasattr(root, 'volume_level') else 1
                step: 0.01
                size_hint_x: 0.8
                on_value: root.set_volume(self.value)

        Widget:
            size_hint_y: 0.5

        ButtonMenu:
            text: "Back"
            size_hint_y: 0.2
            on_press:
                root.go_menu()


<RotatedImage>:
    canvas.before:
        PushMatrix
        Rotate:
            angle: self.angle
            axis: 0, 0, 1
            origin: self.center
    canvas.after:
        PopMatrix


<Fish>:
    source: 'assets/images/fish_01.png'
    size_hint: None, None
    size: dp(300), dp(300)
    allow_stretch: True
    opacity: 0
    

<Game>:
    BoxLayout:
        orientation: "vertical" 
        padding: "30dp"
        spacing: "20dp"   

        canvas:
            Rectangle:
                source: 'assets/images/back_game.png'
                pos: self.pos
                size: self.size

        # Верхнє меню
        BoxLayout:
            size_hint_y: 0.12

            # Текстовий напис "Бали"
            Label:
                text: str(root.score)
                font_size: '56sp'
                size_hint_x: 0.8
                pos_hint: {'center_x': 1}

            # Кнопка-іконка "Дім"
            ButtonIcon: 
                text: '\uE08A' 
                on_press: root.go_home()

        # Ігрова область
        FloatLayout:
            size_hint_y: 0.76
            id: game_window

            Fish:
                id: fish
                center: root.center

            Label:
                id: level_complete
                text: '    Level\ncomplete!'
                color: from_hex('#12F3AF')#colormap['lawngreen']
                font_size: '50sp'
                size_hint_y: None
                height: self.texture_size[1]
                x: root.width / 2 - self.width / 2
                y: root.height / 2 - self.height / 2 + dp(100)
                opacity: 0

        # Нижнє меню
        BoxLayout:
            size_hint_y: 0.12
            
            # Кнопка-іконка "Налаштування"
            ButtonMenu: 
                font_name: 'assets/typicons.ttf'
                text: '\uE04F' 
                size_hint_x: None
                font_size: '38sp'
                pos_hint: {'y': 0}

        # Icon
        # Label:
        #     font_name: 'assets/typicons.ttf'
        #     text: '\uE08A' 
        #     font_size: '56sp'

        